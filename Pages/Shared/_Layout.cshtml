<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@2.0.3"></script>
    <script>

        // hide lazy elements before first paint
        (function () {
            // As soon as the DOM is parsed (but ideally available even earlier)
            const lazyObserver = new MutationObserver(() => {
                document.querySelectorAll('.lazy').forEach(el => {
                    el.style.setProperty('display', 'none', 'important');
                });
            });

            // Observe DOM construction for not yet parsed lazy elements
            lazyObserver.observe(document.documentElement, {
                childList: true,
                subtree: true
            });

            // First pass for already existing `.lazy` elements
            document.addEventListener("DOMContentLoaded", () => {
                document.querySelectorAll('.lazy').forEach(el => {
                    el.style.setProperty('display', 'none', 'important');
                });
                lazyObserver.disconnect(); // If no longer needed
            });
        })();

        document.addEventListener('htmx:afterRequest', function (event) {
            const triggerEl = event.detail.requestConfig?.elt;

            if (!triggerEl) return;

            if (event.detail.xhr.status === 204) {
                triggerEl.classList.remove('lazy');
                triggerEl.style.removeProperty('display');
            }
        });

        // HTMX triggert Events automatisch via HX-Trigger Header
        // Zusätzliches Logging für Debugging
        document.addEventListener('userLoggedIn', function () {
            console.log('User logged in event triggered');
        });

        document.addEventListener('userLoggedOut', function () {
            console.log('User logged out event triggered');
        });
    </script>
</head>

<body class="bg-white text-white">
    <main class="max-w-[1024px] mx-auto p-4 space-y-2">
        @RenderBody()
    </main>
</body>

</html>